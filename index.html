<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Drink Tracker</title>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --moe: #4facfe; --trish: #ff5858; --text: #fff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Layout */
        header { padding: 20px; text-align: center; font-weight: 800; border-bottom: 1px solid #333; }
        #app-content { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; }
        
        /* Profile Buttons */
        .profile-btn { background: var(--card); border: 2px solid #333; padding: 25px; margin: 10px 0; border-radius: 12px; font-size: 1.5rem; text-align: center; font-weight: bold; cursor: pointer; }
        .profile-btn.moe:active { border-color: var(--moe); color: var(--moe); }
        .profile-btn.trish:active { border-color: var(--trish); color: var(--trish); }
        
        /* Tracker Cards */
        .user-card { background: var(--card); border-radius: 16px; padding: 20px; margin-bottom: 20px; text-align: center; border: 1px solid transparent; transition: 0.3s; }
        .user-card.active-user { border-color: #555; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
        .user-name { font-size: 1rem; font-weight: 700; letter-spacing: 1px; margin-bottom: 5px; text-transform: uppercase; }
        .count { font-size: 4.5rem; font-weight: 800; line-height: 1; margin: 10px 0; }
        
        /* Buttons */
        .controls { display: flex; justify-content: center; gap: 20px; }
        .btn { width: 60px; height: 60px; border-radius: 50%; border: none; font-size: 2rem; display: flex; align-items: center; justify-content: center; cursor: pointer; touch-action: manipulation; }
        .minus { background: #2a2a2a; color: #fff; }
        .moe .user-name { color: var(--moe); } .moe .plus { background: var(--moe); color: #fff; }
        .trish .user-name { color: var(--trish); } .trish .plus { background: var(--trish); color: #fff; }

        /* Analytics */
        .chart-box { display: flex; justify-content: space-around; align-items: flex-end; height: 250px; padding-top: 40px; }
        .bar { width: 50px; border-radius: 8px 8px 0 0; display: flex; align-items: flex-end; justify-content: center; padding-bottom: 5px; font-weight: bold; min-height: 10px; transition: height 0.5s; }
        .reset-btn { width: 100%; padding: 15px; border-radius: 8px; font-size: 1rem; margin-top: 40px; font-weight: bold; cursor: pointer; border: 1px solid #ff5858; background: #2a0000; color: #ff5858;}

        /* Nav */
        nav { background: #1a1a1a; border-top: 1px solid #333; display: flex; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { padding: 15px; flex: 1; text-align: center; color: #666; font-size: 0.9rem; }
        .nav-item.active { color: #fff; font-weight: bold; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <header id="title">Who is this?</header>

    <div id="app-content">
        <div id="view-profile" style="margin-top: auto; margin-bottom: auto;">
            <div class="profile-btn moe" onclick="setProfile('Moe')">Moe</div>
            <div class="profile-btn trish" onclick="setProfile('Trish')">Trish</div>
        </div>

        <div id="view-tracker" class="hidden">
            <div class="user-card moe" id="card-moe">
                <div class="user-name">Moe</div>
                <div class="count" id="c-moe">...</div>
                <div class="controls">
                    <button class="btn minus" onclick="mod('moe', -1)">-</button>
                    <button class="btn plus" onclick="mod('moe', 1)">+</button>
                </div>
            </div>
            <div class="user-card trish" id="card-trish">
                <div class="user-name">Trish</div>
                <div class="count" id="c-trish">...</div>
                <div class="controls">
                    <button class="btn minus" onclick="mod('trish', -1)">-</button>
                    <button class="btn plus" onclick="mod('trish', 1)">+</button>
                </div>
            </div>
        </div>

        <div id="view-analytics" class="hidden">
            <div class="chart-box">
                <div style="text-align:center"><div class="bar" id="b-moe" style="background:var(--moe)">0</div><br>Moe</div>
                <div style="text-align:center"><div class="bar" id="b-trish" style="background:var(--trish)">0</div><br>Trish</div>
            </div>
            <button class="reset-btn" onclick="reset()">Reset All (Both Users)</button>
        </div>
    </div>

    <nav id="nav" class="hidden">
        <div class="nav-item active" id="tab-tracker" onclick="nav('tracker')">Tracker</div>
        <div class="nav-item" id="tab-analytics" onclick="nav('analytics')">Analytics</div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, set, runTransaction } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // YOUR FIREBASE CONFIG
        const firebaseConfig = {
          apiKey: "AIzaSyDwjSeEdz3g6ofnvvURIr_Q_q0KII4QtdU",
          authDomain: "drinks-tracker-cb5e5.firebaseapp.com",
          databaseURL: "https://drinks-tracker-cb5e5-default-rtdb.firebaseio.com",
          projectId: "drinks-tracker-cb5e5",
          storageBucket: "drinks-tracker-cb5e5.firebasestorage.app",
          messagingSenderId: "670928393598",
          appId: "1:670928393598:web:1d3bf4c73fe8f7714d0f2f",
          measurementId: "G-36G1HBRE9K"
        };

        // Initialize
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const drinksRef = ref(db, 'drinks'); // Points to the root of your DB

        // Global Data Holder
        window.d = { moe: 0, trish: 0 };
        
        // 1. REAL-TIME LISTENER (Reads changes instantly)
        onValue(drinksRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                window.d = data;
                render();
            } else {
                // If DB is brand new/empty, initialize it
                set(drinksRef, { moe: 0, trish: 0 });
            }
        });

        // 2. WRITE FUNCTION (Updates Firebase)
        window.mod = function(user, amount) {
            // Uses transaction to safely handle simultaneous clicks
            runTransaction(ref(db, 'drinks/' + user), (currentCounts) => {
                let newVal = (currentCounts || 0) + amount;
                return newVal < 0 ? 0 : newVal;
            });
        };

        window.reset = function() {
            if(confirm("Are you sure? This resets counts for BOTH of you.")) {
                set(drinksRef, { moe: 0, trish: 0 });
                nav('tracker');
            }
        };

        // --- UI LOGIC ---
        
        window.setProfile = function(u) {
            localStorage.setItem('drinks_user', u);
            // Hide profile select, show app
            document.getElementById('view-profile').classList.add('hidden');
            document.getElementById('view-tracker').classList.remove('hidden');
            document.getElementById('nav').classList.remove('hidden');
            document.getElementById('title').innerText = "Drink Tracker";
            
            // Highlight active user card
            document.querySelectorAll('.user-card').forEach(c => c.classList.remove('active-user'));
            if(u) document.getElementById('card-'+u.toLowerCase()).classList.add('active-user');
        };

        window.nav = function(t) {
            // Switch Tabs
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active');
            
            document.getElementById('view-tracker').classList.add('hidden');
            document.getElementById('view-analytics').classList.add('hidden');
            document.getElementById('view-'+t).classList.remove('hidden');
            
            document.getElementById('title').innerText = t === 'analytics' ? "Analytics" : "Drink Tracker";
            render(); 
        };

        function render() {
            // Update Numbers
            document.getElementById('c-moe').innerText = window.d.moe;
            document.getElementById('c-trish').innerText = window.d.trish;
            
            // Update Chart
            let max = Math.max(window.d.moe, window.d.trish, 5);
            document.getElementById('b-moe').style.height = (window.d.moe/max*200)+'px';
            document.getElementById('b-moe').innerText = window.d.moe;
            document.getElementById('b-trish').style.height = (window.d.trish/max*200)+'px';
            document.getElementById('b-trish').innerText = window.d.trish;
        }

        // Auto-login if profile was chosen previously
        const savedUser = localStorage.getItem('drinks_user');
        if (savedUser) window.setProfile(savedUser);
    </script>
</body>
</html>
